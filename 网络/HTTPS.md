# HTTP的安全问题

HTTP有以下的安全问题:

1. 使用明文通信,内容可能会被窃听
2. 不验证通信方的真实身份,可能会遭受到中间人攻击
3. 无法验证报文的完整性和正确性,可能会被篡改

# 什么是HTTPS

HTTPS并不是什么新协议,它只是在TCP与HTTP协议之间,增加了一层`TLS/SSL`通信,让HTTPS通过隧道进行通信

通过TLS/SSL层,HTTPS有了加密,认证和完整性保护的功能

![](http://imageblog.boyn.top/202002021113_799.png)

# 加密方法

## 对称加密

对称加密指的是加密和解密都用同一个密钥

- 优点:运算速度快
- 缺点:无法将密钥在没有加密的情况下安全地传输给对方

常见的对称加密算法有`DES`,`SM1`(国密1)

## 非对称加密

非对称加密指的是一方执有公钥,另外一方执有私钥,公钥是可以公开的,在加密的时候,可以用公钥对消息进行加密,用私钥才可以进行解密

- 优点:可以安全地将密钥信息传递给对方
- 缺点:运算速度慢

常见的非对称加密方法有`RSA`,`SM2`(国密2)

# HTTP请求过程

在没有SSL层时,HTTP是直接进行TCP握手,然后在TCP上面进行HTTP通信的

![](http://imageblog.boyn.top/202002021125_388.png)

而这种方法的坏处在于很容易受到中间人攻击

![](http://imageblog.boyn.top/202002021126_644.png)

所以 HTTP 传输面临的风险有：

（1） 窃听风险：黑客可以获知通信内容。

（2） 篡改风险：黑客可以修改通信内容。

（3） 冒充风险：黑客可以冒充他人身份参与通信。

# SSL加密流程

![](http://imageblog.boyn.top/202002021135_390.png)

我们刚刚说到,想要HTTP的传输是安全的,那么就需要进行SSL的加密

在建立了TCP连接后,还要进行SSL层的握手连接,一般服务器的SSL端口是443

1. 客户端先向服务端请求一个HTTPS连接
2. 服务端返回一个数字证书,通过第三方机构保证这个证书合格,证书的内容是服务器公钥
3. 客户端随机生成一个对称加密的密钥,然后将这条密钥信息用服务器公钥进行加密
4. 将加密信息发送给服务器
5. 服务器返回接受信息后,就可以通过该加密通道进行通信了

## 数字证书认证

数字证书认证机构（CA，Certificate Authority）是客户端与服务器双方都可信赖的第三方机构。

服务器的运营人员向 CA 提出公开密钥的申请，CA 在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名，然后分配这个已签名的公开密钥，并将该公开密钥放入公开密钥证书后绑定在一起。

进行 HTTPS 通信时，服务器会把证书发送给客户端。客户端取得其中的公开密钥之后，先使用数字签名进行验证，如果验证通过，就可以开始通信了。

![](http://imageblog.boyn.top/202002021142_502.png)

# TLS 握手

1. 客户端发送`Hello`消息:客户端通过发送一个`Hello`消息来初始化握手过程.这个消息包括客户端支持的TLS版本,支持的加密方法以及一段随机字符串
2. 服务端发送`Hello`消息:作为回应,服务端返回了一个包含服务端本身数字证书的`SSL certificate`,服务端支持的加密方法以及一段随机字符串
3. 认证:客户端从数字证书中取出公钥,并用数字证书的消息来验证是否准确.
4. 协商密钥:客户端再传输一个随机的字符串,作为*协商密钥*.它使用刚刚获得的公钥来加密
5. 服务端解密:服务端使用私钥将消息进行解密
6. 创建Session Key:客户端与服务端都可以以相同的算法,使用分别在1,2,4步发送的随机字符串的组合,生成一个对称密钥
7. 互传确认:客户端与服务端相互传一个消息用于确认,这个消息使用刚刚生成的对称密钥进行加密

