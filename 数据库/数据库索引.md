# 什么是索引

对于数据库来说,索引就是用于快速定位数据的一组包含位置信息的数据.比如一本书上的目录,就是对这本书的索引.

# 索引的分类

我们主要是看看InnoDB的索引机制,它支持以下三种索引

- B+树索引
- 全文索引
- 哈希索引

对于B+树索引和全文索引,是我们在创建或修改表结构的时候指定的,但是哈希索引是自适应的,InnoDB会根据表的使用情况来自动生成哈希索引而无法人为干预

# B+树索引

在关系型数据库中,大多数都是使用B+树来进行索引的,B+树是一种平衡的多叉树,由B树和索引顺序访问方法演化而来.它是为磁盘设计的一种平衡多叉查找树,在B+树中,所有记录的结点按照键值的大小顺序存放在**同一层的叶子结点**中,这也是其与B树不同的地方,B树的数据分布在从根结点到叶子结点的任一节点中,而B+树的数据全部放在叶子结点中

B+树的大致如下所示

![](http://imageblog.boyn.top/202001291146_49.png)

## B+树的插入

![](http://imageblog.boyn.top/202001291139_885.png)

从图中可以看到B+树的插入一般遵循先插入对应的叶子结点,如果叶子节点满了,就将其分裂为两个叶子节点,并将中间的节点放入上一级节点中,但是如果此时上一级也是满的,那么就要将上一级继续分裂,并重复之前的过程

## B+树的删除

在B+树中,有一个参数称为填充因子,当删除后的页中节点数量小于填充因子时,就要对页进行合并

![](http://imageblog.boyn.top/202001291149_50.png)

## InnoDB中的B+树

在InnoDB中,B+树的一个节点对应磁盘空间的一个页,通常来说,一页的大小是4KB,所以一般在数据库表中B+树索引的高度在2~4之间,其IO次数也在2~4次之间,从而节省了很多次的IO.

在B+树索引中,可以分为聚集索引和非聚集索引也称辅助索引.对于InnoDB中表的主键,就是使用聚集索引,其叶子节点上的数据包含了整行全部的数据,而对于其他键的索引,就是使用非聚集索引,其叶子节点保存的是主键的键值,所以我们如果通过非主键的索引进行查询的话,除了要在非主键索引的B+树上查询到对应值的数据之外,还要查询一次主键索引的B+树才可以拿到数据(特殊情况是我们只需要索引值作为查询的返回值,就不用在主键中查询).

